{% extends 'backend/base.html.twig' %}

{% block stylesheets %}
    <link rel="stylesheet" href={{ asset('styles/crud.css') }}>
    <link rel="stylesheet" href={{ asset('styles/dashboard.css') }}>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css" rel="stylesheet"/>
{% endblock %}

{% block activeDash %}active{% endblock %}

{% block title %}Dashboard{% endblock %}

{% block body %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<p> {{ chartUsers.labels.0|json_encode }}, {{ chartUsers.labels.1|json_encode }}, {{ chartUsers.labels.2|json_encode }}, {{ chartUsers.labels.3|json_encode }}, {{ chartUsers.labels.4|json_encode }}, {{ chartUsers.labels.5|json_encode }}, {{ chartUsers.labels.6|json_encode }}</p>

    <div class="col-10 p-0">
            <div class="p-3">
            <h1>Dashboard</h1>
            <div class="stats">
                <div class="cards">
                    <a href="{{ path('apartmentCrud') }}">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Logements</h5>
                                <p class="card-number">{{ apartments}}</p>
                            </div>
                        </div>
                    </a>
                    <a href="{{ path('serviceList') }}">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Services</h5>
                                <p class="card-number">{{ services }}</p>
                            </div>
                        </div>
                    </a>
                    <a href="{{ path('companyList') }}">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Entreprises</h5>
                                <p class="card-number">{{ companies}}</p>
                            </div>
                        </div>
                    </a>
                    <a href="{{ path('lessorList') }}">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Utilisateurs</h5>
                                <p class="card-number">{{ users|length }}</p>
                            </div>
                        </div>
                    </a>
                    <a href="{{ path('reservationList') }}">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Réservations</h5>
                                <p class="card-number">{{ reservations|length }}</p>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="graphandlist">
                <div class="graphs">
                    <div class="graph">  
                        <canvas id="chartUsers"></canvas>     
                    </div>
                    <div class="graph">
                        <div>
                            <canvas id="chartReservations"></canvas>
                        </div>      
                    </div>
                    <div class="graph">
                        <div>
                            <canvas id="myChart"></canvas>
                        </div>     
                    </div>
                </div>
                <div class="lists">
                    <div class="list">
                        <h1>Derniers inscrits</h1>
                        {% for user in users|slice(0, 10) %}
                            <div class="user">      
                                <p class="name"> {{ user.firstname|capitalize }} {{ user.lastname|capitalize }} </p><p class="date"> {{ user.dateInscription | date('d/m/Y H:i:s') }} </p>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="list">
                        <h1>Dernières réservations</h1>
                        {% for reservation in reservations|slice(0, 10) %}
                            <div class="reservation">      
                                {# <p class="name"> {{ reservation.user.firstname|capitalize }} {{ reservation.user.lastname|capitalize }} </p><p class="date"> {{ reservation.dateReservation | date('d/m/Y H:i:s') }} </p> #}
                                <p class="name"> {{ reservation.user.firstname|capitalize }} {{ reservation.user.lastname|capitalize }} </p><p class="date"> 18/03/2005 15:00:00 </p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const xValues = [50,60,70,80,90,100,110,120,130,140,150];
        const yValues = [7,8,8,9,9,9,10,11,14,14,15];

        new Chart("myChart", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                backgroundColor:"rgba(0,0,255,1.0)",
                borderColor: "rgba(0,0,255,0.1)",
                data: yValues
                }]
            },
            options:{}
        });

        const chartUsers = '{{ chartUsers.labels|json_encode|raw }}';
        console.log(chartUsers[2]);
        for (const chartUser of chartUsers) {
            console.log(chartUser[2]);
        }
        const cuLabels = [chartUsers[2] + chartUsers[3] + "/" + chartUsers[5] + chartUsers[6],chartUsers[2] + chartUsers[3] + "/" + chartUsers[5] + chartUsers[6],chartUsers[2] + chartUsers[3] + "/" + chartUsers[5] + chartUsers[6],chartUsers[2] + chartUsers[3] + "/" + chartUsers[5] + chartUsers[6],chartUsers[2] + chartUsers[3] + "/" + chartUsers[5] + chartUsers[6],chartUsers[2] + chartUsers[3] + "/" + chartUsers[5] + chartUsers[6],chartUsers[2] + chartUsers[3] + "/" + chartUsers[5] + chartUsers[6],];
        const cuData = [0, 5, 10, 15, 20, 30, 40];
        new Chart("chartUsers", {
            type: 'line',
            data: {
              labels: cuLabels,
              datasets: [{
                backgroundColor: 'rgba(0, 0, 255, 0.5)',
                borderColor: 'rgba(0, 0, 255, 1)',
                data: cuData,
              }]
            },
            options: {},
          });
    </script>
{% endblock %}

